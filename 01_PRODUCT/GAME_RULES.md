## 0. 문서 목적
- 이 문서는 게임이 성립하기 위한 **규칙과 판정 기준**을 정의한다.
- 모든 규칙은 서버 기준(authoritative)으로 해석된다.
- UI 표현, 통신 방식, 기술 스택은 다루지 않는다.
## 관련 문서
- [[01_PRODUCT/REQUIREMENTS.md]]
- [[01_PRODUCT/ECONOMY.md]]
- [[01_PRODUCT/CATALOG.md]]
---
## 1. 게임 기본 구조
### 1.1 게임 인원
- 최소 인원: 2명
- 최대 인원: 6명
- 게임 시작 이후 인원 변경은 불가능하다.
### 1.2 게임 상태
- 게임의 authoritative stage는 다음 enum으로 관리한다.
  - LOBBY
  - BAN
  - PICK
  - SHOP (구매)
  - PLAY
  - FINISHED
- 페이지 매핑 관점에서 BAN/PICK/SHOP은 BAN_PICK_SHOP 페이지 내부 단계로 처리한다.
---
## 2. 대기실 규칙
### 2.1 방장 규칙
- 방 생성자는 기본 방장이다.
- 방장은 항상 READY 상태로 간주된다.
- 방장만 게임을 시작할 수 있다.
### 2.2 방장 위임
- 방장이 대기실을 떠날 경우,
  - 서버는 남은 플레이어 중 무작위 1명을 방장으로 지정한다.
### 2.3 게임 시작 조건
- 모든 플레이어가 READY 상태여야 한다.
- 방장이 시작을 실행해야 한다.
---
## 3. 게임 유형별 규칙
### 3.1 NORMAL 게임
- 대기실 이후 즉시 IN_GAME(PLAY)로 전환된다.
- BAN/PICK/SHOP 단계는 존재하지 않는다.
- 아이템 및 스펠은 사용할 수 없다.
### 3.2 RANKED 게임
- 게임은 다음 단계를 순서대로 수행한다.
  - BAN → PICK → SHOP → PLAY
---
## 4. 밴 / 픽 규칙 (RANKED)
### 4.1 기본 규칙
- 각 플레이어는 밴 1개, 픽 1개를 선택한다.
- 선택은 제한 시간 내에만 유효하다.
### 4.2 최종 알고리즘 결정
- 전체 알고리즘 풀을 대상으로 한다.
- 플레이어들의 선택 비율에 따라
  - 각 알고리즘의 선택 확률이 증가한다.
- 서버는 확률 가중 방식을 사용하여 최종 알고리즘을 결정한다.
---
## 5. 구매 규칙 (RANKED)
### 5.1 구매 수량 제한
- 아이템: 최대 3개
- 스펠: 최대 2개
### 5.2 구매 유효성
- 서버는 구매 요청 시 다음을 검증한다.
  - 보유 코인이 충분한지
  - 구매 수량 제한을 초과하지 않았는지
- 유효하지 않은 구매는 실패 처리된다.
---
## 6. 인게임 규칙
### 6.1 플레이 제한 시간
- 최대 플레이 시간은 1시간이다.
### 6.2 아이템 / 스펠 사용
- 아이템은 상대 플레이어에게 적용된다.
- 스펠은 자기 자신에게 적용된다.
- 효과 지속 시간 및 적용 여부는 서버에서 관리된다.
---
## 7. 게임 종료 및 결과
### 7.1 종료 조건
- 플레이 시간 만료
- 서버가 판단한 승패 확정
- 조기 종료 조건 충족
  - 활성 참가자 수가 1명 이하가 된 경우
  - 활성 참가자는 `LEFT`/`DISCONNECTED` 상태가 아닌 플레이어로 정의한다.
### 7.2 결과 처리
- 게임 종료 시 게임 상태는 FINISHED로 전환된다.
- FINISHED 상태 이후 active game은 해제된다.
---
## 8. 코드 채점 점수 산정 (RANKED)
### 8.0 적용 범위
- 아래 점수 산정은 RANKED 게임에만 적용한다.
- NORMAL 게임은 REQUIREMENTS 기준으로 점수가 변동되지 않는다.

### 8.1 지표
- 제출 시간
- 실행 시간
- 메모리 사용량
### 8.2 정규화 (min-max)
- 한 게임 내 **유효 제출** 기준으로 min/max를 계산한다.
- 값이 낮을수록 유리하므로 다음처럼 역정규화한다.
  - `X_norm = 1 - (X - X_min) / (X_max - X_min)`
  - 단, `X_max == X_min`이면 `X_norm = 1.0`
### 8.3 가중합 점수
- `S = 5 * T_norm + 4 * R_norm + 1 * M_norm`
- 최종 점수는 `round(S * 1000)` 정수 스케일로 기록한다.
